# 🍜 舌尖上的AI - 完整文档

**让AI带你探索身边的美食世界**

---

## 目录

1. [产品介绍](#产品介绍)
2. [快速开始](#快速开始)
3. [核心功能](#核心功能)
4. [使用指南](#使用指南)
5. [技术架构](#技术架构)
6. [开发历程](#开发历程)
7. [常见问题](#常见问题)

---

# 一、产品介绍

## 📖 产品简介

**舌尖上的AI**是一款创新的智能美食探索平台，结合了**GPS精准定位**、**AI智能推荐**和**多源美食数据聚合**，为你提供最贴心的美食发现体验。

### 适用场景

- 🔍 想找附近好吃的餐厅
- 📝 寻找美食灵感和做菜攻略
- 🥗 关注健康饮食和营养搭配
- 🎯 探索热门美食打卡地

## ✨ 核心特色

### 🎯 GPS精准定位
- **街道级精确定位**：精确到街道、社区级别
- **实时位置感知**：自动获取当前位置
- **详细地址展示**：完整显示位置信息

### 🤖 AI智能推荐
- **关键词智能提取**：AI分析搜索意图
- **气泡式交互**：创新的气泡界面
- **探索路径记录**：面包屑导航

### 📱 多源数据聚合
- **豆果美食**：20万+专业菜谱
- **大众点评**：真实用户笔记
- **百度搜索**：海量美食资讯
- **地理位置智能推荐**：根据你的位置推荐周边美食

### ⭐ 梦幻星空主题
- **动态星空**：100颗闪烁星星
- **流星雨**：定时流星雨效果
- **鼠标交互**：拖尾和点击绽放
- **魔法棒光标**：独特光标设计

---

# 二、快速开始

## 🚀 安装启动

### 1. 启动服务

```bash
./start.sh
```

### 2. 打开浏览器

访问: `http://localhost:8000/index.html`

### 3. 授权定位

- 点击"允许获取位置"按钮
- 在浏览器弹窗中选择"允许"
- 等待几秒加载数据

### 4. 开始使用

探索美食！🎉

## ⚙️ 环境要求

- **Python** 3.7+
- **浏览器**: Chrome/Safari/Firefox/Edge（最新版本）
- **网络**: 需要联网获取在线数据

---

# 三、核心功能

## 1️⃣ 周边热门美食榜单

### 功能说明

基于GPS定位，展示附近最热门的菜品排行。

### 使用方法

- **自动加载**：打开应用自动显示
- **点击查看**：点击菜品卡片查看详情
- **滚动浏览**：滚动查看更多排行

### 智能推荐机制

- **地理位置智能分析**：基于你的当前位置推荐周边热门美食
- **实时排序**：根据推荐热度动态排序，确保推荐最受欢迎的选择

### 适用场景

- 不知道吃什么
- 想吃热门菜品
- 探索新餐厅

---

## 2️⃣ AI智能美食探索

### 功能说明

通过AI关键词提取和气泡式交互，帮助用户逐步细化搜索，发现心仪美食。

### 使用方法

#### 关键词搜索
1. 在搜索框输入关键词（如"火锅"）
2. 按回车键或点击搜索按钮
3. 查看匹配的菜品和店铺

#### AI气泡探索
1. 输入初始关键词
2. AI自动提取相关关键词（以气泡形式展示）
3. 点击气泡继续深入探索
4. 使用面包屑导航回到之前的搜索

#### 筛选条件
- **最低评分**：只显示评分高于设定值的店铺
- **最高人均**：控制价格范围
- **关键字**：精确匹配菜品/店铺名

### 示例流程

```
搜索"火锅" 
  → AI生成气泡：麻辣、清汤、自助、串串、羊肉
  → 点击"麻辣"
  → AI生成气泡：重庆、毛肚、鸳鸯锅
  → 点击"毛肚"
  → 找到心仪的火锅店
```

### 技术特点

- **智能分词**：自动提取搜索关键词
- **关联推荐**：基于相似度算法
- **实时过滤**：毫秒级响应
- **状态保存**：记录探索路径

---

## 3️⃣ 美食笔记

### 功能说明

聚合多平台美食笔记，提供真实用户的美食体验分享。

### 使用方法

#### 搜索笔记
1. 输入关键词（自动添加"大众点评"）
2. 等待搜索结果
3. 翻页查看更多笔记

#### 查看详情
- **大众点评笔记**：弹窗完整展示标题、内容、图片
- **其他来源**：提示跳转到原网站

### 数据来源

- **大众点评**：真实用户笔记（完整解析）
- **百度笔记**：跳转原站（防爬虫限制）
- **携程旅行**：跳转原站（页面复杂）

### 笔记详情包含

- 📝 **标题**：笔记主题
- 👤 **作者**：发布用户
- 📅 **发布时间**：时间戳
- 📷 **图片**：美食照片（最多9张）
- 💬 **内容**：完整笔记正文
- 🔗 **来源**：原文链接

### 技术实现

- **反爬虫处理**：模拟浏览器请求
- **重定向跟踪**：自动跟随跳转
- **JSON解析**：提取Next.js数据
- **HTML清洗**：移除无关标签

---

## 4️⃣ 美食菜谱

### 功能说明

专业菜谱库，提供详细的做菜教程和健康饮食指导。

### 功能模块

#### 🔍 关键字搜索
- **菜名搜索**：输入菜名查找菜谱
- **食材搜索**：输入食材找菜谱
- **实时搜索**：豆果美食20万+菜谱

#### ⭐ 精选推荐
- **自动加载**：点击tab自动加载
- **随机推荐**：每次推荐不同菜品
- **高质量**：精选优质菜谱

#### 🥗 饮食健康
10个健康分类：
- 减肥瘦身
- 美容养颜
- 健脾养胃
- 补钙强骨
- 提高免疫力
- 清热去火
- 润肺止咳
- 糖尿病
- 高血压

### 菜谱详情

#### 基本信息
- 📝 **菜品名称**
- 📷 **成品图片**
- 📝 **简介**：菜品特点

#### 材料清单
- **主料**：食材和用量
- **辅料**：调料和配菜

#### 制作步骤
- 步骤编号
- 详细说明
- 配图展示

#### 烹饪小贴士
- 💡 技巧和注意事项
- 自动过滤广告文案

### 数据来源

- **豆果美食**：中国最大的菜谱网站
- **实时获取**：每次搜索实时抓取
- **防爬策略**：Cookie管理、延迟请求

---

# 四、使用指南

## 🎨 界面布局

### 顶部区域
- **Logo**：舌尖上的AI 🍜
- **位置信息**：当前位置详细地址
- **重新定位**：点击刷新位置
- **AI设置**：配置API密钥（可选）

### 内容区域
- **Tab切换**：4个主要功能模块
- **搜索框**：关键词输入
- **筛选条件**：评分、价格等
- **结果展示**：卡片式布局

### 底部区域
- **翻页控制**：上一页/下一页
- **页码显示**：当前页/总页数

## 🎯 操作技巧

### 快速搜索

**方法1：搜索框输入**
- 输入关键词
- 按回车或点击搜索

**方法2：气泡点击**
- AI生成的关键词气泡
- 点击直接搜索

**方法3：面包屑**
- 点击面包屑回到之前的搜索

### 查看详情

**菜品详情**
- 点击菜品卡片
- 查看店铺信息

**笔记详情**
- 点击笔记卡片
- 查看完整内容或跳转

**菜谱详情**
- 点击菜谱卡片
- 查看制作步骤

### 关闭弹窗

- 点击弹窗外部
- 点击右上角 ✕
- 按 ESC 键

## ⚙️ 设置选项

### 筛选条件

| 条件 | 说明 | 示例 |
|-----|------|------|
| 关键字 | 搜索菜品/店铺名 | "牛肉面" |
| 最低评分 | 筛选高分店铺 | 4.5分以上 |
| 最高人均 | 控制价格范围 | 100元以下 |

### AI配置（可选）

- 点击右上角 ⚙️
- 输入API密钥
- 仅保存在本地浏览器

---

# 五、技术架构

## 💻 技术栈

### 前端

| 技术 | 用途 | 版本 |
|-----|------|------|
| HTML5 | 语义化结构 | - |
| CSS3 | 样式和动画 | - |
| JavaScript | 业务逻辑 | ES6+ |
| P5.js | 粒子特效 | - |

**核心API**:
- Geolocation API：GPS定位
- Fetch API：网络请求
- LocalStorage：本地存储

### 后端

| 技术 | 用途 | 版本 |
|-----|------|------|
| Python | 核心语言 | 3.7+ |
| Flask | Web框架 | 3.0 |
| Flask-CORS | 跨域支持 | 4.0 |
| Requests | HTTP请求 | 2.31 |
| SQLite | 数据存储 | 3 |

### 第三方API

| API | 用途 | 备注 |
|-----|------|------|
| 百度搜索 | 美食笔记搜索 | 需反爬 |
| 豆果美食 | 菜谱数据 | 需反爬 |
| 高德地图 | 逆地理编码 | 需API Key |
| OpenStreetMap | 备用地理编码 | 免费 |

## 🏗️ 系统架构

### 整体架构

```
┌─────────────────────────────────────┐
│          用户浏览器                   │
│  ┌─────────────────────────────┐    │
│  │      前端 (8000端口)          │    │
│  │  - index.html               │    │
│  │  - script.js                │    │
│  │  - style.css                │    │
│  │  - p5-bg.js                 │    │
│  └─────────────────────────────┘    │
└─────────────────────────────────────┘
           ↓ HTTP/HTTPS ↓
┌─────────────────────────────────────┐
│      后端API (5000端口)              │
│  ┌─────────────────────────────┐    │
│  │    Flask Application         │    │
│  │  - /api/search-notes        │    │
│  │  - /api/note-detail         │    │
│  │  - /api/search-recipes      │    │
│  │  - /api/recipe-detail       │    │
│  │  - /api/featured-recipes    │    │
│  │  - /api/health-recipes      │    │
│  │  - /api/geocode             │    │
│  │  - /api/dishes              │    │
│  │  - /api/shops               │    │
│  └─────────────────────────────┘    │
└─────────────────────────────────────┘
           ↓ HTTP Requests ↓
┌─────────────────────────────────────┐
│        外部API/数据源                 │
│  - 百度搜索                          │
│  - 豆果美食                          │
│  - 大众点评                          │
│  - 高德地图                          │
│  - 地理位置推荐引擎                  │
└─────────────────────────────────────┘
```

### 数据流向

```
用户操作 → 前端JS → 后端API → 外部数据源
                              ↓
                          数据处理
                              ↓
         显示界面 ← 前端渲染 ← JSON返回
```

## 📊 数据库设计

### SQLite数据库

**文件**: `data.db`

**表结构**:

#### dishes (菜品表)
```sql
CREATE TABLE dishes (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    image_url TEXT,
    recommendation_count INTEGER,
    shop_name TEXT,
    created_at TIMESTAMP
)
```

**索引**:
- `idx_dishes_shop`: 店铺名索引
- `idx_dishes_count`: 推荐数索引（降序）

#### shops (店铺表)
```sql
CREATE TABLE shops (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    avg_price TEXT,
    address TEXT,
    phone TEXT,
    detail_url TEXT,
    score REAL,
    created_at TIMESTAMP
)
```

**索引**:
- `idx_shops_name`: 店铺名索引
- `idx_shops_score`: 评分索引（降序）

### 数据统计

- **菜品总数**: 1,048条
- **店铺总数**: 194家
- **推荐总数**: 23,416次
- **平均评分**: 3.92分
- **数据库大小**: 408 KB

## 🔒 安全与反爬

### 反爬虫策略

#### 1. User-Agent模拟
```python
headers = {
    'User-Agent': 'Mozilla/5.0 ...',
    'Accept-Language': 'zh-CN,zh;q=0.9',
}
```

#### 2. Cookie管理
```python
# 先访问首页获取Cookie
session.get('https://www.douguo.com/')
# 再访问目标页面
session.get(target_url)
```

#### 3. 请求延迟
```python
time.sleep(random.uniform(0.5, 1.5))
```

#### 4. 重定向处理
```python
response = session.get(url, allow_redirects=True)
real_url = response.url
```

### GPS定位安全

#### 浏览器安全策略

**要求**:
- 必须在安全上下文（HTTPS或localhost）
- 需要用户手势触发（user gesture）
- 用户显式授权

**实现**:
```javascript
// 等待用户点击授权按钮
await new Promise((resolve) => {
  authButton.addEventListener('click', resolve);
});

// 用户点击后才请求GPS
const position = await getGPSLocation();
```

### CORS跨域处理

```python
from flask_cors import CORS

app = Flask(__name__)
CORS(app, resources={
    r"/api/*": {
        "origins": "*",
        "methods": ["GET", "POST"],
        "allow_headers": ["Content-Type"]
    }
})
```

---

# 六、开发历程

## 🏗️ 开发阶段

### 第一阶段：基础功能（Week 1-2）

**完成内容**:
- ✅ 周边热门美食榜单
- ✅ AI智能美食探索
- ✅ 美食笔记搜索
- ✅ 基础UI布局

**技术突破**:
- CSV数据加载和解析
- 智能关键词提取算法
- 百度搜索API集成

### 第二阶段：功能增强（Week 3-4）

**新增功能**:
- ✅ 美食菜谱模块
  - 关键字搜索
  - 精选推荐
  - 饮食健康分类

**问题解决**:
- 豆果美食403/404错误
- 美食笔记乱码问题
- URL跳转错误

### 第三阶段：深度优化（Week 5-6）

**优化内容**:
- ✅ 笔记详情弹窗展示
- ✅ 多来源笔记差异化处理
- ✅ 菜谱详情优化
- ✅ GPS精准定位

**技术改进**:
- 反爬虫策略优化
- JSON数据解析
- 逆地理编码
- 启动页流程

### 第四阶段：UI/UX提升（Week 7-8）

**视觉优化**:
- ⭐ 星空背景（100颗星星）
- 💫 流星雨效果
- 🪄 魔法棒光标
- ✨ 鼠标交互特效

**交互改进**:
- GPS授权引导
- 弹窗标题实时更新
- 内容过滤优化
- 自动加载功能

### 第五阶段：数据优化（Week 9）

**核心改进**:
- CSV → SQLite数据库
- API接口开发
- 降级策略
- 性能提升2-17倍

### 第六阶段：简化完善（Week 10）

**用户体验**:
- 一键启动脚本
- 文档简化
- 快速使用指南
- GPS授权优化

## 🐛 主要问题及解决

### 1. 豆果美食403错误

**问题**: 菜谱搜索返回403 Forbidden

**原因**: 
- 错误的URL路径
- 缺少必要的Cookie

**解决**:
```python
# 1. 修正URL路径
url = f"https://www.douguo.com/caipu/{keyword}"

# 2. 先访问首页获取Cookie
session.get('https://www.douguo.com/')

# 3. 再访问目标页面
response = session.get(url, headers=headers)
```

### 2. 美食笔记乱码

**问题**: 百度笔记返回乱码

**原因**: Brotli压缩编码问题

**解决**:
```python
# 针对百度，不接受Brotli编码
headers = {
    'Accept-Encoding': 'gzip, deflate'  # 排除br
}
```

### 3. GPS定位违规

**问题**: `[Violation] Only request geolocation...`

**原因**: 页面加载时自动请求GPS

**解决**:
```javascript
// 添加授权按钮，等待用户点击
await new Promise((resolve) => {
  authButton.addEventListener('click', resolve);
});

// 用户点击后才请求GPS
const location = await getGPSLocation();
```

### 4. 笔记内容提取

**问题**: 不同来源笔记结构差异大

**解决**:
- **大众点评**: 解析JSON数据（完整展示）
- **百度笔记**: 检测安全验证（跳转原站）
- **携程旅行**: 页面复杂（跳转原站）

### 5. 菜谱广告过滤

**问题**: Tips中包含豆果美食广告

**解决**:
```javascript
// 正则过滤广告文案
filteredTips = tips.replace(
  /做菜好吃都有技巧.*?豆果.*?菜谱[！!。]*/g, 
  ''
);

// 标点符号标准化
if (lastChar === '，') {
  filteredTips = filteredTips.slice(0, -1) + '。';
}
```

## 📈 性能优化

### 查询性能提升

| 操作 | CSV | SQLite | 提升 |
|-----|-----|--------|------|
| 全量加载 | 100ms | 50ms | 2x |
| 按店铺筛选 | 80ms | 10ms | 8x |
| 排序 | 60ms | 5ms | 12x |
| 分页查询 | 50ms | 3ms | 17x |

### 文件大小优化

- CSV格式: 530 KB (2个文件)
- SQLite格式: 408 KB (1个文件)
- **压缩率**: 23% ⬇️

### 启动流程优化

| 阶段 | 优化前 | 优化后 | 提升 |
|-----|-------|--------|------|
| 启动步骤 | 6步 | 1步 | 6x |
| 终端窗口 | 2个 | 1个 | 50% |
| 文档行数 | 378行 | 121行 | 68% |
| 上手时间 | 15分钟 | 3分钟 | 80% |

---

# 七、常见问题

## 🔧 启动问题

### Q1: Python版本错误？

**A**: 确保Python版本 >= 3.7

```bash
python3 --version
# 输出应该是 Python 3.7 或更高
```

### Q2: 端口被占用？

**A**: 检查8000和5000端口

```bash
# 查看端口占用
lsof -i :8000
lsof -i :5000

# 杀死占用进程
kill -9 <PID>
```

### Q3: 依赖安装失败？

**A**: 使用国内镜像源

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

## 📍 定位问题

### Q4: 无法获取定位？

**A**: 检查以下几点：
1. 使用`localhost`访问（不是IP地址）
2. 浏览器允许了定位权限
3. 设备GPS已开启
4. 点击了"允许获取位置"按钮

### Q5: 定位不准确？

**A**: 
- GPS定位需要几秒时间
- 点击右上角定位图标重新定位
- 确保在室外或窗边（GPS信号更好）

### Q6: 地址显示英文？

**A**: 
- 已自动切换到中文
- 如果还是英文，刷新页面

## 🔍 搜索问题

### Q7: 搜索没有结果？

**A**: 
- 检查筛选条件是否过严
- 尝试更通用的关键词
- 确保网络连接正常

### Q8: 笔记内容不完整？

**A**: 
- 只有大众点评笔记完整展示
- 其他来源点击"前往原网站查看"

### Q9: 菜谱图片加载慢？

**A**: 
- 图片来自外部网站，速度取决于网络
- 可以点击跳转到豆果美食查看

## 🎨 界面问题

### Q10: 星空背景看不见？

**A**: 
- 清除浏览器缓存（Cmd+Shift+R）
- 刷新页面
- 检查控制台是否有JavaScript错误

### Q11: 光标没有变成魔法棒？

**A**: 
- 部分元素需要鼠标悬停
- 浏览器需要支持自定义光标
- Safari可能显示效果略有不同

## 🛠️ 其他问题

### Q12: 如何停止服务？

**A**: 在终端按`Ctrl+C`

### Q13: 数据会自动更新吗？

**A**: 
- **本地数据**：不会自动更新
- **在线数据**：每次搜索实时获取

### Q14: 可以离线使用吗？

**A**: 
- 周边美食榜单：✅ 可离线
- 美食探索：✅ 可离线
- 美食笔记：❌ 需要联网
- 美食菜谱：❌ 需要联网

---

## 📞 获取帮助

如果遇到其他问题：

1. **查看控制台**：按F12查看浏览器控制台
2. **查看后端日志**：查看终端输出
3. **清除缓存**：尝试清除浏览器缓存
4. **重启服务**：停止后重新启动

---

## 📄 许可证

MIT License

---

**文档版本**: v1.0  
**最后更新**: 2025-10-27  
**项目名称**: AI-Gourmet (舌尖上的AI)  
**英文名**: AI-Gourmet  
**中文名**: 舌尖上的AI

🎉 **感谢使用舌尖上的AI！**

